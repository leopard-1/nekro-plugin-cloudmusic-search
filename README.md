# 网易云音乐点歌插件

通过 AI 搜索和播放网易云音乐歌曲的插件。

## 功能

- 🔍 **搜索歌曲**：通过关键词搜索网易云音乐
- 🖼️ **图片展示**：搜索结果以精美图片列表展示
- 🎵 **播放音乐**：在 QQ 群/私聊中发送音乐卡片或语音消息

## 配置

### 必需配置

**网易云音乐 Cookie**

1. 打开浏览器访问 https://music.163.com
2. 登录你的网易云音乐账号
3. 按 F12 打开开发者工具
4. 切换到 Network（网络）标签
5. 刷新页面，点击任意请求
6. 在 Request Headers 中找到 Cookie 字段
7. 复制完整的 Cookie 值到插件配置中

> **重要**：Cookie 必须包含 `MUSIC_U` 和 `__csrf` 字段，否则无法使用

### 可选配置

- **背景图 URL**：自定义搜索结果图片的背景（建议 800x800）
- **字体路径**：自定义字体文件，如 `msyh.ttc`（微软雅黑）或 `simsun.ttc`（宋体）
- **最大搜索结果数**：1-20，默认 15
- **HTTP 超时**：网络请求超时时间（秒）
- **启用 JSON 卡片**：是否使用 JSON 卡片发送音乐（默认开启）
- **封面尺寸**：发送封面图片的尺寸（像素），0 表示不发送封面

## 使用方法

### 搜索歌曲

对 AI 说：
```
搜索歌曲 晴天
搜索歌曲 周杰伦 稻香
```

AI 会返回搜索结果的精美图片列表，包含歌曲名称、艺术家、专辑和歌曲 ID。

### 播放歌曲

从搜索结果中选择歌曲 ID，对 AI 说：
```
播放歌曲 347230
```

**播放方式：**

1. **JSON 卡片模式**（默认，需要 API 支持）
   - 发送精美的网易云音乐 JSON 卡片
   - 点击卡片可直接播放

2. **降级模式**（当 JSON 卡片不可用时）
   - 发送歌曲文字信息
   - 发送歌曲封面图片
   - 发送歌曲语音消息

> **注意**：仅支持 QQ（OneBot v11 协议），其他平台会返回网易云音乐链接

## 常见问题

**Q：提示"未正确配置"是什么原因？**

A：检查 Cookie 是否正确配置，必须包含 `MUSIC_U` 和 `__csrf` 字段。

**Q：搜索不到歌曲怎么办？**

A：
1. 检查关键词是否正确
2. 确认网易云音乐中能搜到这首歌
3. 检查 Cookie 是否过期（重新登录获取新 Cookie）

**Q：无法播放音乐？**

A：
1. 确认是在 QQ 群或 QQ 私聊中使用
2. 检查 bot 是否有发送消息的权限
3. 查看日志了解具体错误信息

**Q：为什么有时发送卡片，有时发送语音？**

A：
- 当"启用 JSON 卡片"开启且 API 可用时，会发送精美的 JSON 卡片
- 当 API 不可用或卡片发送失败时，自动降级为文字+封面+语音的方式

**Q：Cookie 安全吗？**

A：Cookie 包含你的账号信息，请妥善保管，不要分享给他人。插件仅用于搜索和获取歌曲信息。

**Q：封面尺寸设置为 0 是什么意思？**

A：设置为 0 表示在降级模式下不发送封面图片，只发送文字和语音。

## 版权声明

本插件仅供学习交流使用，请遵守音乐版权相关法律法规。

## 问题反馈

- 作者：sakuralis  
- 仓库：https://github.com/leopard-1/nekro-plugin-cloudmusic-search
- 遇到问题请提交 Issue
